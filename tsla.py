# -*- coding: utf-8 -*-
"""TSLA.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/18-8BZyMwfN0CZQ6t7tPZZFWrFaOfrJGX
"""

import pandas as pd
import numpy as np

r=pd.read_csv('tesla.csv.csv')
print(r)

r.head(5)

training=r['Open']
print(training.head())
train=  r.iloc[:,1:2].values

from sklearn.preprocessing import MinMaxScaler
sc=MinMaxScaler(feature_range=(0,1))
train_scale=sc.fit_transform(train)
x=[]
y=[]

for i in range(60,len(train_scale)):
  x.append(train_scale[i-60:i,0])
  y.append(train_scale[i,0])
x=np.array(x)
y=np.array(y)

print(y[0])

x=np.reshape(x,(x.shape[0],x.shape[1],1))

from keras.models import Sequential
from keras.layers import  Dense
from keras.layers import  LSTM
from  keras.layers import Dropout

reg=Sequential()
reg.add(LSTM(units=50,return_sequences=True,input_shape=(x.shape[1],1)))
reg.add(Dropout(0.2))
reg.add(LSTM(units=50,return_sequences=True))
reg.add(Dropout(0.2))
reg.add(LSTM(units=50))
reg.add(Dropout(0.2))
reg.add(Dense(units=1))
reg.compile(optimizer='Adam',loss='mean_squared_error')
reg.fit(x,y,epochs=50,batch_size=32)

dataset_test = pd.read_csv('tesla_test.csv')
real_stock_price = dataset_test.iloc[:, 1:2].values

# Getting the predicted stock price of 2017
dataset_total = pd.concat((r['Open'], dataset_test['Open']), axis = 0)
inputs = dataset_total[len(dataset_total) - len(dataset_test) - 60:].values
inputs = inputs.reshape(-1,1)
inputs = sc.transform(inputs)
X_test = []
for i in range(60, 72):
    X_test.append(inputs[i-60:i, 0])
X_test = np.array(X_test)
X_test = np.reshape(X_test, (X_test.shape[0], X_test.shape[1], 1))
predicted_stock_price = reg.predict(X_test)
predicted_stock_price = sc.inverse_transform(predicted_stock_price)

x=(predicted_stock_price)
y=(real_stock_price)
plt.plot(x)
plt.plot(y)

